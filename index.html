<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Circle Hub â€” Anonymous Forum & Random Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ---------- BASE ---------- */
body { font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,sans-serif; margin:0; padding:0; background:#f4f4f9; color:#111827; transition: background .3s, color .3s;}
.container { max-width:760px; margin:0 auto; padding:40px 16px; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:40px; }
header h1 { font-size:28px; font-weight:700; color:#4f46e5; }
header nav button { margin-left:10px; padding:8px 16px; border-radius:20px; border:none; cursor:pointer; transition:.2s; }
header nav button.active { background:#4f46e5; color:white; }
header nav button.inactive { background:#e5e7eb; color:#111; }
section { display:none; }
section.active { display:block; }

/* ---------- DARK MODE ---------- */
body.dark { background:#111827; color:#f4f4f9; }
body.dark header h1 { color:#a78bfa; }
body.dark header nav button.active { background:#a78bfa; color:#111827; }
body.dark .card { background:#1f2937; box-shadow:0 8px 24px rgba(0,0,0,0.3); }
body.dark .post-body, body.dark .ai { color:#d1d5db; }
body.dark textarea, body.dark #messageInput { background:#374151; color:#f4f4f9; border:1px solid #4b5563; }
body.dark .bubble { background:#374151; color:#f4f4f9; }

/* ---------- FORUM ---------- */
.card { background:#fff; border-radius:16px; padding:20px; box-shadow:0 8px 24px rgba(0,0,0,0.05); margin-bottom:24px; transition:.3s;}
.post { padding:16px 0; border-bottom:1px solid #e5e7eb; }
.post:last-child { border-bottom:none; }
.post-body { font-size:15px; color:#374151; }
.ai { margin-top:12px; font-size:14px; color:#6b7280; font-style:italic; }
textarea { width:100%; border:1px solid #e5e7eb; border-radius:12px; padding:12px; font-size:15px; resize:vertical; min-height:80px; transition:.3s;}
button.post-btn { margin-top:12px; background:#4f46e5; color:white; border:none; border-radius:999px; padding:10px 20px; font-size:14px; cursor:pointer; }

/* ---------- CHAT ---------- */
#chatBox { background:white; border-radius:15px; padding:16px; height:400px; overflow-y:auto; border:1px solid #ddd; margin-bottom:12px; transition:.3s;}
.message { display:flex; align-items:flex-end; margin:6px 0; }
.message.me { justify-content:flex-end; }
.message .avatar { width:30px; height:30px; border-radius:50%; background:#ccc; margin:0 8px; flex-shrink:0; }
.message .bubble { max-width:70%; padding:8px 14px; border-radius:15px; background:#e5e7eb; font-size:14px; word-wrap:break-word; transition:.2s; opacity:0; transform:translateY(10px);}
.message.me .bubble { background:#4f46e5; color:white; }
.message .bubble.show { opacity:1; transform:translateY(0);}
#inputContainer { display:flex; margin-bottom:40px; }
#messageInput { flex:1; padding:10px; border-radius:25px; border:1px solid #ccc; font-size:14px; }
#sendBtn { padding:10px 20px; margin-left:10px; border-radius:25px; border:none; background:#4f46e5; color:white; font-size:14px; cursor:pointer; }

/* Footer */
footer { text-align:center; font-size:14px; color:#9ca3af; margin-top:48px; }
footer a { color:#6b7280; text-decoration:none; margin:0 8px; }
</style>
</head>
<body>
<div class="container">
<header>
  <h1>Circle Hub</h1>
  <nav>
    <button id="forumTabBtn" class="active">Forum</button>
    <button id="chatTabBtn" class="inactive">Random Chat</button>
  </nav>
</header>

<!-- ---------- LANDING ---------- -->
<section id="landing" class="active" style="text-align:center;">
  <h2 style="font-size:24px; margin-bottom:20px;">Welcome to Circle Hub</h2>
  <p style="font-size:16px; color:#6b7280; margin-bottom:40px;">
    A modern anonymous community with reflective AI and real-time chat.
  </p>
  <button id="startForum" style="padding:12px 25px; border-radius:25px; border:none; background:#4f46e5; color:white; font-size:16px; cursor:pointer; margin-right:20px;">
    Go to Forum
  </button>
  <button id="startChat" style="padding:12px 25px; border-radius:25px; border:none; background:#e5e7eb; color:#111; font-size:16px; cursor:pointer;">
    Start Random Chat
  </button>
</section>

<!-- ---------- FORUM ---------- -->
<section id="forumTab">
  <h2 style="text-align:center; font-size:24px; margin-bottom:20px;">Anonymous Forum</h2>
  <p style="text-align:center; color:#6b7280; margin-bottom:30px;">
    Share your thoughts freely. AI offers reflective responses.
  </p>
  <div class="card" id="board">
    <div class="post">
      <div class="post-body">I sometimes feel like I am not living up to my potential.</div>
      <div class="ai">Circle: That feeling of "not enough" often comes from your inner critic.</div>
    </div>
  </div>
  <div class="card">
    <strong>Post something</strong>
    <p class="note">Posts are local and temporary. AI reflections are suggestive, not advice.</p>
    <textarea id="forumInput" placeholder="Type your thoughts here..."></textarea>
    <button id="forumPostBtn" class="post-btn">Post</button>
    <p class="note">Prohibited content: harassment, scams, or adult material.</p>
  </div>
</section>

<!-- ---------- CHAT ---------- -->
<section id="chatTab">
  <p style="text-align:center; color:#6b7280; margin-bottom:20px;">
    Click start to be randomly paired. Messages disappear on refresh.
  </p>
  <button id="startBtn">Start Chat</button>
  <div id="chatBox"></div>
  <div id="inputContainer">
    <input type="text" id="messageInput" placeholder="Type a message..." disabled>
    <button id="sendBtn" disabled>Send</button>
  </div>
</section>

<footer>
  <p>This website is NOT a dating service and does NOT provide matchmaking.</p>
  <p>
    <a href="privacy.html">Privacy</a> Â·
    <a href="rules.html">Community Rules</a>
  </p>
  Â© Circle Hub 2026
</footer>
</div>

<!-- ---------- SCRIPTS ---------- -->
<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ----------------- TAB SWITCH -----------------
const forumTabBtn = document.getElementById('forumTabBtn');
const chatTabBtn = document.getElementById('chatTabBtn');
const forumTab = document.getElementById('forumTab');
const chatTab = document.getElementById('chatTab');
const landing = document.getElementById('landing');
function showSection(section){
  [landing, forumTab, chatTab].forEach(s=>s.classList.remove('active'));
  section.classList.add('active');
}
forumTabBtn.onclick=()=>{showSection(forumTab); forumTabBtn.className='active'; chatTabBtn.className='inactive';}
chatTabBtn.onclick=()=>{showSection(chatTab); chatTabBtn.className='active'; forumTabBtn.className='inactive';}
document.getElementById('startForum').onclick=forumTabBtn.onclick;
document.getElementById('startChat').onclick=chatTabBtn.onclick;

// ----------------- DARK MODE -----------------
const darkToggle=document.createElement('button');
darkToggle.textContent='ðŸŒ™';
darkToggle.style.cssText='position:fixed; top:16px; right:16px; padding:8px 12px; border:none; border-radius:12px; cursor:pointer; background:#4f46e5; color:white;';
document.body.appendChild(darkToggle);
darkToggle.onclick=()=>{document.body.classList.toggle('dark'); localStorage.setItem('theme',document.body.classList.contains('dark')?'dark':'light');}
window.onload=()=>{if(localStorage.getItem('theme')==='dark') document.body.classList.add('dark');}

// ----------------- FORUM -----------------
const forumAIResponses=["You paused there. That often means it matters more than you're admitting.","Your calm words hide stronger emotions underneath.","Most people would have stopped typing. You didn't.","You're exploring your safety in saying this, not seeking an answer.","That thought shows persistence under stress.","Your words were chosen carefully, almost like a protective shield.","Something is left unsaid, a subtle pause we notice"];
document.getElementById('forumPostBtn').onclick=()=>{ 
  const text=document.getElementById('forumInput').value.trim(); if(!text)return;
  const board=document.getElementById('board');
  const postDiv=document.createElement('div'); postDiv.className='post';
  const body=document.createElement('div'); body.className='post-body'; body.textContent=text;
  const ai=document.createElement('div'); ai.className='ai'; ai.textContent='Circle is thinkingâ€¦';
  postDiv.appendChild(body); postDiv.appendChild(ai); board.appendChild(postDiv);
  document.getElementById('forumInput').value='';
  setTimeout(()=>{ const r=forumAIResponses[Math.floor(Math.random()*forumAIResponses.length)]; ai.textContent='Circle: '+r; },900);
  board.scrollTop=board.scrollHeight;
}

// ----------------- FIREBASE CONFIG -----------------
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ----------------- PEERJS SETUP -----------------
let peer = new Peer();
let conn = null;
let partnerId = null;
const signalsRef = db.collection('signals');

peer.on('open', id=>{
  console.log('My Peer ID:', id);
  signalsRef.add({peerId:id, timestamp:Date.now()});
  findPartner(id);
});

async function findPartner(myId){
  const snapshot = await signalsRef.orderBy('timestamp').get();
  for(const doc of snapshot.docs){
    const data=doc.data();
    if(data.peerId!==myId){
      partnerId=data.peerId;
      conn=peer.connect(partnerId);
      setupConnection(conn);
      return;
    }
  }
}

peer.on('connection', c=>{ conn=c; partnerId=c.peer; setupConnection(conn); });

function setupConnection(c){
  c.on('open', ()=>console.log('Connected to partner!'));
  c.on('data', data=>{
    if(data.type==='text') appendMessage(data.msg,false);
    else if(data.type==='image') appendImageMessage(data.data,false);
  });
}

// ----------------- CHAT FUNCTIONS -----------------
const chatInput=document.getElementById('messageInput'); 
const sendButton=document.getElementById('sendBtn'); 
const chatBoxEl=document.getElementById('chatBox');

function appendMessage(msg,isMe=false){
  const div=document.createElement('div'); div.classList.add('message'); if(isMe) div.classList.add('me');
  const avatar=document.createElement('div'); avatar.className='avatar'; avatar.style.background=isMe?'#4f46e5':'#ccc';
  const bubble=document.createElement('div'); bubble.className='bubble'; bubble.textContent=msg; bubble.classList.add('show');
  if(isMe){ div.appendChild(bubble); div.appendChild(avatar);} else { div.appendChild(avatar); div.appendChild(bubble);}
  chatBoxEl.appendChild(div); chatBoxEl.scrollTop=chatBoxEl.scrollHeight;
}

sendButton.onclick=()=>{
  const msg=chatInput.value.trim(); if(!msg||!conn) return;
  appendMessage(msg,true);
  conn.send({type:'text', msg});
  chatInput.value='';
}

// ---------- IMAGE UPLOAD ----------
const uploadBtn=document.createElement('input');
uploadBtn.type='file'; uploadBtn.accept='image/*'; uploadBtn.style.marginLeft='10px';
document.getElementById('inputContainer').appendChild(uploadBtn);

uploadBtn.onchange=()=>{
  const file=uploadBtn.files[0]; if(!file||!conn) return;
  const reader=new FileReader();
  reader.onload=e=>{
    const dataURL=e.target.result;
    conn.send({type:'image', data:dataURL});
    appendImageMessage(dataURL,true);
  }
  reader.readAsDataURL(file);
  uploadBtn.value='';
}

function appendImageMessage(src,isMe=false){
  const div=document.createElement('div'); div.classList.add('message'); if(isMe) div.classList.add('me');
  const avatar=document.createElement('div'); avatar.className='avatar'; avatar.style.background=isMe?'#4f46e5':'#ccc';
  const bubble=document.createElement('div'); bubble.className='bubble';
  const img=document.createElement('img'); img.src=src; img.style.maxWidth='200px'; img.style.borderRadius='12px';
  bubble.appendChild(img);
  if(isMe){ div.appendChild(bubble); div.appendChild(avatar);} else { div.appendChild(avatar); div.appendChild(bubble);}
  chatBoxEl.appendChild(div); chatBoxEl.scrollTop=chatBoxEl.scrollHeight;
}
</script>
</body>
</html>
