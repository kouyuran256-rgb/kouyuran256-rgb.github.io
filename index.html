<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AnonChat â€” Random P2P Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* Reset & base */
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'Inter', system-ui, sans-serif;
  background: #f0f2f5;
  color: #111827;
}
.container {
  max-width: 720px;
  margin: 50px auto;
  padding: 0 20px;
}

/* Header */
h1 {
  text-align: center;
  font-size: 36px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 8px;
}
.subtitle {
  text-align: center;
  font-size: 16px;
  color: #6b7280;
  margin-bottom: 30px;
}

/* Start button */
#startBtn {
  display: block;
  margin: 0 auto 20px auto;
  padding: 14px 30px;
  background: linear-gradient(90deg,#4f46e5,#6366f1);
  color: #fff;
  font-size: 16px;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
#startBtn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
}

/* Chat box */
#chatBox {
  background: #ffffff;
  border-radius: 20px;
  padding: 16px;
  height: 450px;
  overflow-y: auto;
  border: 1px solid #e5e7eb;
  margin-bottom: 15px;
  box-shadow: 0 6px 12px rgba(0,0,0,0.04);
}

/* Messages */
.message {
  display: flex;
  align-items: flex-end;
  margin: 8px 0;
  animation: fadeIn 0.25s ease;
}
.message.me { justify-content: flex-end; }
.message .avatar {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #d1d5db;
  margin: 0 8px;
}
.message .bubble {
  max-width: 68%;
  padding: 10px 16px;
  border-radius: 20px;
  background: #e5e7eb;
  font-size: 15px;
  line-height: 1.4;
  word-wrap: break-word;
}
.message.me .bubble { background: #4f46e5; color: #fff; }

/* Input container */
#inputContainer {
  display: flex;
  margin-bottom: 40px;
}
#messageInput {
  flex: 1;
  padding: 12px 16px;
  border-radius: 25px;
  border: 1px solid #d1d5db;
  font-size: 15px;
}
#sendBtn {
  padding: 12px 24px;
  margin-left: 12px;
  border-radius: 25px;
  border: none;
  background: #4f46e5;
  color: white;
  cursor: pointer;
  font-size: 15px;
  transition: transform 0.1s ease;
}
#sendBtn:hover { transform: translateY(-1px); }

/* Animations */
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

</style>
</head>
<body>

<div class="container">
<h1>AnonChat</h1>
<p class="subtitle">Connect with a random stranger instantly. Your messages are private and disappear on refresh.</p>

<button id="startBtn">Start Random Chat</button>

<div id="chatBox"></div>

<div id="inputContainer">
  <input type="text" id="messageInput" placeholder="Type your message..." disabled>
  <button id="sendBtn" disabled>Send</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
import Peer from "https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-analytics.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAC9HWZx10dKzI1vy9gm5gWODmBYrdGUlM",
  authDomain: "us256-33f2c.firebaseapp.com",
  projectId: "us256-33f2c",
  storageBucket: "us256-33f2c.firebasestorage.app",
  messagingSenderId: "456338392274",
  appId: "1:456338392274:web:74ee8577be6625b778990b",
  measurementId: "G-F286QQYRY6"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const db = getFirestore(app);
const waitingUsersCol = collection(db, "waitingUsers");

// PeerJS
let myPeer = new Peer(undefined, { host: '0.peerjs.com', port: 443, path: '/' });
let conn;

const chatBox = document.getElementById('chatBox');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const startBtn = document.getElementById('startBtn');

// Random avatar color
function randomColor() {
  const colors = ['#F87171','#FBBF24','#34D399','#60A5FA','#A78BFA','#F472B6'];
  return colors[Math.floor(Math.random() * colors.length)];
}

// Append message
function appendMessage(msg, isMe=false){
  const div = document.createElement('div');
  div.classList.add('message');
  if(isMe) div.classList.add('me');

  const avatar = document.createElement('div');
  avatar.className = 'avatar';
  avatar.style.background = randomColor();

  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.textContent = msg;

  if(isMe){
    div.appendChild(bubble);
    div.appendChild(avatar);
  } else {
    div.appendChild(avatar);
    div.appendChild(bubble);
  }

  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Send message
sendBtn.onclick = () => {
  const msg = messageInput.value;
  if(!msg || !conn || conn.open === false) return;
  conn.send(msg);
  appendMessage(msg, true);
  messageInput.value = '';
}

// Start random chat
startBtn.onclick = async () => {
  startBtn.disabled = true;
  appendMessage("ðŸ”¹ Waiting for a random stranger...");

  myPeer.on('open', async id => {
    const myDoc = await addDoc(waitingUsersCol, { peerId: id });

    onSnapshot(waitingUsersCol, snapshot => {
      snapshot.docChanges().forEach(async change => {
        if(change.type === "added" && change.doc.id !== myDoc.id){
          const otherPeerId = change.doc.data().peerId;
          appendMessage("ðŸ”¹ Stranger found. Connecting...");
          conn = myPeer.connect(otherPeerId);

          conn.on('open', () => {
            appendMessage("âœ… Connection established. Start chatting!");
            messageInput.disabled = false;
            sendBtn.disabled = false;
          });

          conn.on('data', data => appendMessage(data, false));

          deleteDoc(doc(db, "waitingUsers", change.doc.id));
          deleteDoc(doc(db, "waitingUsers", myDoc.id));
        }
      });
    });
  });

  myPeer.on('connection', c => {
    conn = c;
    conn.on('open', () => {
      appendMessage("âœ… Stranger connected. Start chatting!");
      messageInput.disabled = false;
      sendBtn.disabled = false;
    });
    conn.on('data', data => appendMessage(data, false));
  });
}
</script>

</body>
</html>
